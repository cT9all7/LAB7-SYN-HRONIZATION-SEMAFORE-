# LAB7-SYN-HRONIZATION-SEMAFORE-
НЕБОЛЬШИЕ ПРОБЛЕМЫ С УДАЛЕНИЕМ ПРОЦЕССОВ ПРИ СОЗДАНИИ БОЛЬШЕ ОДНОГО ПОТРЕБИТЕЛЯ И ПРОИЗВОДИТЕЛЯ


Лабораторная работа No 7. Задача производители-потребители для
процессов
Основной процесс создает очередь сообщений, после чего ожидает и обрабатыва-
ет нажатия клавиш, порождая и завершая процессы двух типов —производители и по-
требители.
Очередь сообщений представляет собой классическую структуру — кольцевой бу-
фер, содержащий указатели на сообщения, и пара указателей на голову и хвост. Поми-
мо этого очередь содержит счетчик добавленных сообщений и счетчик извлеченных.
Производители формируют сообщения и, если в очереди есть место, перемещают
их туда, потребители, если в очереди есть сообщения, извлекают их оттуда, обрабаты-
вают и освобождают память с ними связанную.
Для работы используются два семафора для заполнения и извлечения, а также
мьютекс или одноместный семафор для монопольного доступа к очереди.
Производители генерируют сообщения, используя системный генератор rand(3)
для size и data. В качестве результата для size используется остаток от деления на 257.
Поскольку байт не может содержать значение size, равное 256, для него использу-
ется старший (знаковый) бит поля type. Фактически, этот бит определяет фиксирован-
ный размер сообщения, равный 256 бит, поле size при этом игнорируется.
При формировании сообщения контрольные данные формируются из всех эле-
ментов. Значение поля hash при вычислении контрольных данных принимается рав-
ным нулю. Для расчета контрольных данных можно использовать любой подходящий
алгоритм.
После помещения значения в очередь перед освобождением мьютекса очереди
производитель инкрементирует счетчик добавленных сообщений. Затем после подня-
тия семафора выводит строку на stdout, содержащую помимо всего новое значение
этого счетчика.
Потребитель, получив доступ к очереди, извлекает сообщение и удаляет его из
очереди. Перед освобождением мьютекса очереди инкрементирует счетчик извлечен-
ных сообщений. Затем после поднятия семафора проверяет контрольные данные и вы-
водит строку на stdout, содержащую помимо всего новое значение счетчика извлечен-
ных сообщений.
При получении сигнала о завершении процесс должен завершить свой цикл и
только после этого завершиться, не входя в новый.
Следует предусмотреть задержки, чтобы вывод можно было успеть прочитать в
процессе работы программы.
